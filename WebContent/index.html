<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Test</title>
<script type="text/javascript" charset="utf-8" src="js/jquery-1.3.2.js"></script>
<script type="text/javascript">
	// WebSocket connection
	var ws;
	
	// Function to check whether WebSockets are supported
	// Returns true if so and false otherwise
	function webSocketSupported() {
		return "WebSocket" in window;
	}
	
	// Function: connect to the server
	function connToServer() {
		if(webSocketSupported() === false) {
			var $textarea = $('#messages');
			$textarea.val("Sorry, WebSocket is not supported in your browser");
		}
		else{
			// Create new WebSocket connection to the ISIS server
			// Use 8081 to allow TCP/IP monitoring (normal => 8080)
			ws = new WebSocket("ws://localhost:8081/ServerProcessISIS/ISISServlet");
			// Response to event that occurs when WebSocket connection is opened
			ws.onopen = function() {
				var $textarea = $('#messages');
				$textarea.val("Opened client-server connection: " + "\n");
			};
			// Response to event that occurs when the server sends the client a message
			ws.onmessage = function(event) {
				// Print out the received message
				var $textarea = $('#messages');
				$textarea.val($textarea.val() + event.data + "\n");
				alert("Message received from server: " + event.data);
				//console.log(event.data);
				/*$textarea.animate({
					scrollTop : $textarea.height()
				}, 1000);*/
				// Close the connection with the server
				//ws.close();
			};
			// Response to event that occurs when WebSocket connection is closed
			ws.onclose = function(event) {
				var $textarea = $('#messages');
				$textarea.val("Closed client-server connection: " + "\n");
				//event.code event.reason event.wasClean
			};
			// Response to event that occurs when WebSocket connection error occurs
			ws.onerror = function(event) {
				var $textarea = $('#messages');
				$textarea.val("Error with WebSocket connection: " + event.data + "\n");
				// Close the connection with the server
				ws.close();
				$textarea.val($textarea.val() + "Closed client-server connection: " + 
						event.data + "\n");
			};
		}// else
	}// connToServer()
					
	// Function: send message to the server
	function sendMessage() {
		/*if(ws === null) {
			$('#messages').val("Cannot send message without connecting to the server first\n");
			return;
		}*/
		/*if(ws.readyState !== OPEN) {
			$('#messages').val($('#messages').val() + "Sorry, cannot send message without connecting first\n");
			return;
		}*/
		// Read the text entered by the user and send to server via WebSocket connection
		var message = $('#message').val();
		ws.send(message);
		// Clear the message box
		$('#message').val('');
		// Notify the user that their message has been sent
		var $textarea = $('#messages');
		$textarea.val($textarea.val() + "Your message: " + message + " has been sent to the server\n");
	}// sendMessage()
		
	// Function: disconnect from the server
	function disconnFromServer() {
		ws.close();
	}// disconnFromServer()
</script>
</head>
<body>
	<h1>Hello ISIS World!</h1>
	<h5>- Hit Connect to connect to the ISIS server</h5>
	<h5>- Enter text into the message box and hit Send to send messages to the ISIS server</h5>
	<h5>- Hit Disconnect to disconnect from the ISIS server</h5>
	<br />
	<div id="chatboxbody">
		<div id="chatbox">
			<textarea id="messages" rows="16" cols="48" readonly="readonly"></textarea>
		</div>

		<form name="message" action="">
			<input name="usermsg" type="text" id="message" size="63" />
			<input type="button" name="submitmsg" value="Send..." onclick="sendMessage();" />
			<input type="button" name="connect" value="Connect..." onclick="connToServer();" />
			<input type="button" name="disconnect" value="Disconnect..." onclick="disconnFromServer();" />
		</form>
	</div>
</body>
</html>
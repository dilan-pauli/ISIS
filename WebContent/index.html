<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Test</title>
<script type="text/javascript" charset="utf-8" src="js/jquery-1.3.2.js"></script>
<script type="text/javascript">
	// WebSocket connection
	var ws;
	
	// Function to check whether WebSockets are supported
	// Returns true if so and false otherwise
	function webSocketSupported() {
		return "WebSocket" in window;
	}

	// Register ready listener: When the document is ready, open a WebSocket connection
	$(document)
			.ready(
					function() {
						if(webSocketSupported() === false) {
							var $textarea = $('#messages');
							$textarea.val("Sorry, WebSocket is not supported in your browser");
						}
						else{
							// Create new WebSocket connection to the ISIS server
							// Use 8081 to allow TCP/IP monitoring (normal => 8080)
							ws = new WebSocket(
									"ws://localhost:8081/ServerProcessISIS/ISISServlet");
							// Response to event that occurs when WebSocket connection is opened
							ws.onopen = function(event) {
								var $textarea = $('#messages');
								$textarea.val("Opened client-server connection: " + event.data + "\n");
							}
							// Response to event that occurs when the server sends the client a message
							ws.onmessage = function(event) {
								var $textarea = $('#messages');
								// "Message received from server: "
								$textarea.val($textarea.val() + event.data + "\n");
								/*$textarea.animate({
									scrollTop : $textarea.height()
								}, 1000);*/
								// Close the connection with the server
								//ws.close();
							}
							// Response to event that occurs when WebSocket connection is closed
							ws.onclose = function(event) {
								var $textarea = $('#messages');
								$textarea.val("Closed client-server connection: " + event.data + "\n");
								//event.code event.reason event.wasClean
							}
							// Response to event that occurs when WebSocket connection error occurs
							ws.onerror = function(event) {
								var $textarea = $('#messages');
								$textarea.val("Error with WebSocket connection: " + event.data + "\n");
								// Close the connection with the server
								ws.close();
								$textarea.val($textarea.val() + "Closed client-server connection: " + 
										event.data + "\n");
							}
						}
					});
					
	// Function: send message to the server
	function sendMessage() {
		// Read the text entered by the user and send to server via WebSocket connection
		var message = $('#message').val();
		ws.send(message);
		// Clear the message box
		$('#message').val('');
		// Notify the user that their message has been sent
		var $textarea = $('#messages');
		$textarea.val("Your message has been sent to the server\n");
	}
</script>
</head>
<body>
	<h1>Hello ISIS World!</h1>
	<br />
	<h4>Enter text into the message box to send messages to the ISIS server</h4>
	<br />
	<br />
	<div id="chatboxbody">
		<div id="chatbox">
			<textarea id="messages" rows="16" cols="48" readonly="readonly"></textarea>
		</div>

		<form name="message" action="">
			<input name="usermsg" type="text" id="message" size="63" /> <input
				type="button" name="submitmsg" value="Send..."
				onclick="sendMessage();" />
		</form>
	</div>
</body>
</html>